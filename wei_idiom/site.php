<?php
 goto MFQJm; MFQJm: defined('IN_IA') or exit('Access Denied'); goto zNLjo; zNLjo: define('MY_MODULE_ROOT', IA_ROOT . '/addons/wei_idiom'); goto N_OaI; N_OaI: class Wei_idiomModuleSite extends WeModuleSite { public function __construct() { include_once MY_MODULE_ROOT . '/core/func/function.php'; self::register(); } public static function register() { spl_autoload_register('loadModel'); spl_autoload_register('loadUtils'); } public function doWebOrder() { goto ky0IH; ReNgg: if (!$keyword) { goto NvU5r; } goto P0Vue; kDXfG: JMmeD: goto SsVP6; s0NPT: OTlqf: goto gnZ3K; TBK6y: $pager = pagination($total, $pageIndex, $pageSize); goto Qf0oE; UFLnu: G0n2p: goto AeBBb; L05yv: IMKSc: goto iMvQz; hdF0s: if (!($op == 'confirm')) { goto dFZLD; } goto p37SB; ky0IH: global $_W, $_GPC; goto b2VEf; v8Wt9: $pageIndex = max(1, intval($_GPC['page'])); goto ZoPrs; HKjGm: $where = []; goto D72Af; b2VEf: $op = $_GPC['op'] ? $_GPC['op'] : 'display'; goto y8VnX; lDpCv: WpTb6: goto vP60o; P0Vue: $where['nickname LIKE'] = "%{$keyword}%"; goto t5_6U; Gdx7B: OG6nC: goto HKjGm; D72Af: $keyword = trim($_GPC['keyword']) ? trim($_GPC['keyword']) : ''; goto ReNgg; RogLG: dFZLD: goto ExLQC; w1jz5: response(-1, '记录不存在'); goto UFLnu; sdnWx: if (!empty($order)) { goto G0n2p; } goto w1jz5; ZoPrs: $pageSize = 10; goto R6zHz; AeBBb: if (!($order['status'] != IdiomOrder::STATUS_DEFAULT)) { goto uTxNL; } goto KfUax; SsVP6: response(0, 'ok'); goto RogLG; t5_6U: NvU5r: goto v8Wt9; D9iH0: $record = IdiomOrder::getById($_W['uniacid'], $id); goto RUBpk; eBoXD: uTxNL: goto t3hJV; RUBpk: $user = IdiomUser::getUser($record['uniacid'], $record['openid']); goto ITLYu; IUexd: $order = IdiomOrder::getById($_W['uniacid'], $id); goto sdnWx; HpqAE: $db_res = IdiomOrder::updateById($_W['uniacid'], $order['id'], $pairs); goto IcXlb; gnZ3K: $id = trim($_GPC['id']); goto D9iH0; rLgjY: if ($op == 'detail') { goto IMKSc; } goto hdF0s; vP60o: $total = IdiomOrder::getOrderCount($_W['uniacid'], $where); goto TBK6y; KfUax: response(-1, '状态不正确'); goto eBoXD; xepSn: $list = fillListWithIdiomUser($list, ["headimgurl", "nickname", "wxid", "realname", "mobile"]); goto uQ1zW; pd4HX: faFo5: goto Vx4yF; uQ1zW: $list = convertIdiomOrder($list); goto lDpCv; p37SB: if (!(!isset($_GPC['id']) || empty($_GPC['id']))) { goto faFo5; } goto YNHZA; YNHZA: response(-1, '参数缺失'); goto pd4HX; ExLQC: goto eoQXG; goto L05yv; Q38lR: include $this->template('web/order'); goto blZ7K; ITLYu: $user = convertBalance($user); goto zakIB; cpN00: message('参数缺失'); goto s0NPT; Vx4yF: $id = intval($_GPC['id']); goto IUexd; t3hJV: $pairs = ["status" => IdiomOrder::STATUS_SEND, "send_time" => date('Y-m-d H:i:s')]; goto HpqAE; iMvQz: if (!(!isset($_GPC['id']) || empty($_GPC['id']))) { goto OTlqf; } goto cpN00; lpPOW: response(-1, '发货失败'); goto kDXfG; Qf0oE: Cmp1r: goto Q38lR; IcXlb: if (!(false == $db_res)) { goto JMmeD; } goto lpPOW; P8J9r: if (empty($list)) { goto WpTb6; } goto xepSn; y8VnX: if ($op == 'display') { goto OG6nC; } goto rLgjY; R6zHz: $list = IdiomOrder::getOrderList($_W['uniacid'], $where, $pageIndex, $pageSize); goto P8J9r; sCDt7: goto Cmp1r; goto Gdx7B; zakIB: eoQXG: goto sCDt7; blZ7K: } public function getIdiomById($id) { $res = pdo_fetch("select id,name,spell from dati_cy where id = {$id}"); return $res; } public function getByPrefix($prefix) { $res = pdo_fetch("select id,prefix from ims_wei_idiom_topic_bak where prefix = '{$prefix}'"); return $res; } public function getByPinYin($pinyin) { goto GElbN; GElbN: $sql = "select id,hanzi,pinyin,bihua from zidian where `pinyin` = '{$pinyin}' limit 50"; goto JSIcq; JSIcq: $res = pdo_fetchall($sql); goto sYuEw; sYuEw: return false == $res ? [] : $res; goto BC1dt; BC1dt: } private function cutString($str) { return preg_split('/(?<!^)(?!$)/u', $str); } private function isOk($idiom) { goto Y42aF; AtipD: HsBAP: goto IUVbp; ijRdt: if (!(sizeof($spell_arr) != 4)) { goto h9WrQ; } goto Yk_Js; Yk_Js: return false; goto p4oCu; XU2X1: $name_arr = $this->cutString($name); goto McglL; p4oCu: h9WrQ: goto S9rd2; sNlVR: return false; goto AtipD; i5qpo: wWQZs: goto h3r2K; h3r2K: $prefix_topic = $this->getByPrefix($pre); goto IjjVg; l0JVr: $spell_arr = explode('  ', $spell); goto ijRdt; Y42aF: $name = $idiom['name']; goto XU2X1; m90II: Fe0SE: goto xsKRQ; W7xKM: return false; goto i5qpo; McglL: $name_arr = array_unique($name_arr); goto sJPJu; NQI7T: if (!in_array($pre, self::$prefixs)) { goto wWQZs; } goto W7xKM; sJPJu: if (!(sizeof($name_arr) < 4)) { goto HsBAP; } goto sNlVR; xsKRQ: return true; goto g94Rr; JhrBo: return false; goto m90II; IUVbp: $spell = trim($idiom['spell']); goto l0JVr; IjjVg: if (empty($prefix_topic)) { goto Fe0SE; } goto JhrBo; S9rd2: $pre = mb_substr($name, 0, 6); goto NQI7T; g94Rr: } private static $black = array("一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "百", "千", "万", "不", "大"); private function getKeyIndex($idiom) { goto kotwe; GmzTD: $key_index = mt_rand(0, 3); goto ILn1_; MZHw6: XoVPf: goto gjBZn; l6iz2: return $key_index; goto e7ed6; ILn1_: goto UDSUi; goto MZHw6; hMOJf: if (in_array($first, self::$black)) { goto XoVPf; } goto GmzTD; Ym6f1: UDSUi: goto l6iz2; kotwe: $first = mb_substr($idiom['name'], 0, 3); goto hMOJf; gjBZn: $key_index = mt_rand(1, 3); goto Ym6f1; e7ed6: } private static $topics = array(); private static $prefixs = array(); public function doMobileBuild() { goto nk8SE; JG7ha: foreach ($list as $k => $v) { goto Luvdv; q618k: $alternatives_arr = array_unique($alternatives_arr); goto paqb1; x9_zP: $sql .= '(__uniacid,' . '\'' . $v['keyword'] . '\',' . $v['key_index'] . ',\'' . $v['alternatives'] . '\',' . $v['res_index'] . ',\'' . '__insert_time\'),'; goto fOmRN; knG4X: ho3Xv: goto x9_zP; RBVe9: goto BHKJk; goto knG4X; paqb1: if (!(count($alternatives_arr) == 3)) { goto ho3Xv; } goto RBVe9; Luvdv: $alternatives_arr = explode(',', $v['alternatives']); goto q618k; kO5UE: BHKJk: goto qkQsv; fOmRN: $len++; goto kO5UE; qkQsv: } goto rMU6A; Ba8Z0: $len = 0; goto JG7ha; nk8SE: $list = pdo_fetchall('select id,uniacid,keyword,key_index,alternatives,res_index from ims_wei_idiom_topic_bak where id < 2877'); goto F5_VI; F5_VI: $sql = 'INSERT INTO `__topic_table` (`uniacid`,`keyword`,`key_index`,`alternatives`,`res_index`,`insert_time`) VALUES '; goto Ba8Z0; SP4cR: var_dump($len, $sql); goto Prr1u; rMU6A: vQ2Zo: goto N3y3Q; N3y3Q: $sql = substr($sql, 0, strlen($sql) - 1); goto SP4cR; Prr1u: } public function doMobileMake() { goto G4wlY; NtPbL: goto PgHBM; goto w12S3; vFSL9: $this->insertTopic(); goto cV0k9; pgGBD: if (!($i < $end)) { goto zwMHA; } goto MQ0S1; wkVLx: d3sm2: goto eDiQw; GbbJP: $start = intval($_GPC['start']); goto S0W28; kuB0e: vsoln: goto uJgBt; vykLQ: if (!(!isset($_GPC['start']) || empty($_GPC['start']))) { goto d3sm2; } goto qflmm; Vxhe0: $i++; goto NtPbL; A2yod: $i = $start; goto WKDpP; G4wlY: global $_GPC; goto vykLQ; nU7Wo: die('缺少参数:end'); goto kuB0e; MQ0S1: $this->doMobileBot($i); goto qlpBh; qflmm: die('缺少参数:start'); goto wkVLx; WKDpP: PgHBM: goto pgGBD; eDiQw: if (!(!isset($_GPC['end']) || empty($_GPC['end']))) { goto vsoln; } goto nU7Wo; S0W28: $end = intval($_GPC['end']); goto A2yod; w12S3: zwMHA: goto vFSL9; uJgBt: set_time_limit(0); goto GbbJP; qlpBh: mU5aY: goto Vxhe0; cV0k9: } public function insertTopic() { goto tikb2; tikb2: if (!empty(self::$topics)) { goto kg8ah; } goto k_gsR; RgBEJ: cY7Dl: goto zradn; vnaOy: try { pdo_run($sql); var_dump('ok'); } catch (Exception $e) { var_dump($e); } goto B0dCP; zradn: $sql = substr($sql, 0, strlen($sql) - 1); goto vnaOy; bpDX1: $sql = 'INSERT INTO ims_wei_idiom_topic_bak (`prefix`,`keyword`,`key_index`,`alternatives`,`res_index`, `insert_time`) VALUES '; goto CSyjs; OFtBx: kg8ah: goto bpDX1; k_gsR: return; goto OFtBx; CSyjs: foreach (self::$topics as $k => $v) { $sql .= "('{$v['prefix']}','{$v['keyword']}','{$v['key_index']}','{$v['alternatives']}','{$v['res_index']}','{$v['insert_time']}'),"; n9FFy: } goto RgBEJ; B0dCP: } public function doMobileBot($id) { goto s1Rsf; Vcr6R: $conti = true; goto QZ89o; cz0Fi: goto rpMsH; goto boNP9; eecQ_: $i = 0; goto vqjoq; VO6wY: $conti = true; goto gcO0G; RzWlo: return; goto Xq_xl; QZ89o: mY4je: goto VxoZ8; tZ3WQ: $i++; goto cz0Fi; ERFag: $zi = $this->getByPinYin($key_spell); goto dhzJv; XTrwh: $spell_arr = explode('  ', $spell); goto la2ml; Xq_xl: tHQ3V: goto yeMIj; x4h6u: if ($ok) { goto xcoHV; } goto k6oW5; nOTnT: gV0Kc: goto xhnLK; Ln8Ha: $alternatives_arr = []; goto ZMgId; TfFFe: JYECM: goto VO6wY; VxoZ8: goto PsDOL; goto TfFFe; qfOnq: BFoB_: goto zGU8G; bBvfa: if ($zi[$k]['bihua'] <= 2) { goto JYECM; } goto Ymq1q; a63Rf: j56J9: goto tZ3WQ; i0Tqx: if (!($i <= 3)) { goto Btvjd; } goto K3J0W; oxy9v: $conti = false; goto NI_hD; hZfZ8: cnx3H: goto a63Rf; dhzJv: if (!(empty($zi) || sizeof($zi) < 8)) { goto tHQ3V; } goto RzWlo; y0ePV: xcoHV: goto HEbkR; ZMgId: $name_arr = $this->cutString($idiom['name']); goto eecQ_; Xr0l1: $ok = $this->isOk($idiom); goto x4h6u; s1Rsf: $idiom = $this->getIdiomById($id); goto Xr0l1; ckPlS: $spell = trim($idiom['spell']); goto XTrwh; cnPCl: $alternatives = implode(',', $alternatives_arr); goto NbDeD; NI_hD: goto mY4je; goto vVhdc; yeMIj: $res_index = mt_rand(0, 3); goto Ln8Ha; K3J0W: if ($i == $res_index) { goto gV0Kc; } goto JfBBi; gcO0G: PsDOL: goto lQGDx; vVhdc: Bf9Uq: goto Vcr6R; la2ml: $key_spell = $spell_arr[$key_index]; goto ERFag; zGU8G: goto cnx3H; goto nOTnT; JfBBi: NXjZB: goto W4PV4; HEbkR: $key_index = $this->getKeyIndex($idiom); goto ckPlS; EeEDL: $prefix = mb_substr($idiom['name'], 0, 6); goto cnPCl; k6oW5: return; goto y0ePV; kv2QS: $alternatives_arr[] = $zi[$k]['hanzi']; goto oxy9v; Ymq1q: if (in_array($zi[$k]['hanzi'], $alternatives_arr)) { goto Bf9Uq; } goto kv2QS; vqjoq: rpMsH: goto i0Tqx; W4PV4: $k = mt_rand(0, sizeof($zi) - 1); goto bBvfa; NbDeD: $this->addToTopic($prefix, $idiom['name'], $key_index, $alternatives, $res_index); goto ZAwsV; lQGDx: if ($conti) { goto NXjZB; } goto qfOnq; boNP9: Btvjd: goto EeEDL; xhnLK: $alternatives_arr[] = $name_arr[$key_index]; goto hZfZ8; ZAwsV: } private function addToTopic($prefix, $keyword, $key_index, $alternatives, $res_index) { goto ebazr; WEuJh: self::$topics[] = $data; goto KXYDk; ebazr: $data = compact('prefix', 'keyword', 'key_index', 'alternatives', 'res_index'); goto MJtu9; KXYDk: self::$prefixs[] = $prefix; goto wNhIj; MJtu9: $data['insert_time'] = date('Y-m-d H:i:s'); goto WEuJh; wNhIj: } } ?>